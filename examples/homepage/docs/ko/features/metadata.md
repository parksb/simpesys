# 메타데이터

Simpesys는 문서의 생성 및 수정 타임스탬프를 별도의 메타데이터 파일로 추적한다. 이 문서는 메타데이터 시스템과 저장 형식, 동기화 동작을 설명한다. 각 문서에는 다음과 같은 메타데이터가 있다.

- `createdAt`: 문서가 처음 생성된 타임스탬프.
- `updatedAt`: 문서가 마지막으로 수정된 타임스탬프.

메타데이터는 프로젝트 루트의 JSON 파일에 저장되고, 초기화 과정에서 파일 시스템 타임스탬프와 동기화된다.

## 저장 형식

메타데이터는 프로젝트 루트의 `simpesys.metadata.json`에 저장된다.

```json
{
  "index": {
    "createdAt": "2025-01-15T10:30:00Z",
    "updatedAt": "2025-02-20T14:45:00Z"
  },
  "guide": {
    "createdAt": "2025-01-16T09:00:00Z",
    "updatedAt": "2025-01-16T09:00:00Z"
  },
  "features/toc": {
    "createdAt": "2025-01-20T11:00:00Z",
    "updatedAt": "2025-03-01T08:30:00Z"
  }
}
```

JSON 객체의 키는 문서 키에 해당한다. 타임스탬프는 ISO 8601 문자열로 저장된다.

## 타임스탬프 해석

초기화 중에 Simpesys는 여러 소스에서 타임스탬프를 해석한다.

### 우선순위

1. 기존 메타데이터 파일: 문서가 이미 메타데이터 파일에 있으면 해당 타임스탬프를 사용한다.
2. 파일 시스템 타임스탬프: 실제 문서 파일의 생성 시각과 수정 시각을 읽는다.

### 동기화 로직

각 문서에 대해 다음과 같은 로직을 수행한다.

- 기존 메타데이터 항목이 없으면 파일 시스템 타임스탬프를 사용한다.
- 기존 메타데이터가 있으면:
  - `createdAt`은 기존 값을 보존한다.
  - `updatedAt`은 파일의 수정 시간이 저장된 값보다 새로운 경우에만 업데이트한다.

이 접근 방식은 다음을 보장한다.

- 생성 타임스탬프가 배포 환경 간에 안정적으로 유지된다.
- 수정 타임스탬프가 실제 파일 변경을 반영한다.
- 수동 메타데이터 편집이 존중된다.
- 마크다운 문서 파일을 Simpesys 명세와 분리한다.

## 메타데이터 동기화

메타데이터를 동기화하려면 파일시스템 접근이 필요하므로, 기본적으로 메타데이터 동기화는 비활성화되어있다. 문서의 메타데이터를 추적해야 한다면 `init()` 메서드에 `syncMetadata: true` 옵션을 전달해 동기화를 활성화해야 한다.

```typescript
await new Simpesys(/* ... */).init({ syncMetadata: true });
```

## 비공개 문서 제외

`private/`로 시작하는 키를 가진 문서는 메타데이터 동기화에서 제외한다. 이는 비공개 문서 경로가 공개 메타데이터 파일에 나타나는 것을 방지한다. 현재 비공개 문서에 대한 메타데이터를 추적하는 기능은 제공하지 않는다.
